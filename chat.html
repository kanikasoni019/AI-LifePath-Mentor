<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Mentor Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="max-w-2xl mx-auto mt-10">
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="p-4 border-b">
        <h2 class="text-lg font-semibold">ðŸ’¬ AI LifePath Mentor</h2>
        <p class="text-sm text-gray-500">Professional, calm, and helpful guidance.</p>
      </div>
      <div id="chatBox" class="p-4 h-96 overflow-y-auto space-y-4 bg-gray-50"></div>
      <div class="p-4 border-t flex gap-3 items-center">
        <input id="userInput" type="text" placeholder="Type your message..." class="flex-1 px-3 py-2 border rounded-md" />
        <button id="sendBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md">Send</button>
      </div>
      <div class="p-4 border-t text-sm text-gray-600" id="emotionDisplay">Emotion: <strong>â€”</strong></div>
    </div>
  </div>

<script>
const sendBtn = document.getElementById('sendBtn');
const userInput = document.getElementById('userInput');
const chatBox = document.getElementById('chatBox');
const emotionDisplay = document.getElementById('emotionDisplay');

function appendMessage(who, text){
  const el = document.createElement('div');
  el.className = who === 'user' ? 'text-right' : 'text-left';
  el.innerHTML = `<div class="inline-block ${who==='user' ? 'bg-indigo-50 text-indigo-800' : 'bg-white text-gray-800'} px-4 py-2 rounded shadow">${text}</div>`;
  chatBox.appendChild(el);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage(){
  const message = userInput.value.trim();
  if(!message) return;
  appendMessage('user', message);
  userInput.value = '';
  try{
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({message})
    });
    const data = await res.json();
    appendMessage('bot', data.reply);
    emotionDisplay.innerHTML = `Emotion: <strong>${data.emotion}</strong> (confidence: ${Math.round(data.confidence*100)}%)`;
  }catch(err){
    appendMessage('bot', 'Sorry, the server is unreachable. If you are running locally, ensure the backend is started.');
  }
}

sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keydown', function(e){ if(e.key==='Enter') sendMessage(); });
</script>

</body>
</html>